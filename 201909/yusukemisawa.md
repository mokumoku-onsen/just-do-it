# 概要

| Name | yusuke misawa |
|:-----------|:------------|
| Job | Softwear Engineer(Backend) |
| Twitter | https://twitter.com/FpmpAmpm |
| 趣味 | ボルダリング |

# 今回やること
1. mediaDo.go(https://mediado-go.connpass.com/event/140848/)でしゃべる資料を作る
2. 英語のべんきょう（日曜日の夜に電話テストあるのでなんとかする

# なにかやったことを書いていく
## 資料作り
### タイトル
パイプラインパターンでGoのバッチ処理をうまく並列化する

### タスクリスト
初日の目標
- [] 話の流れを考える
- [] つくるスライドのリストを作る

### 伝えたいメッセージを考える
生きていればなんらかのバッチ処理を作る必要に迫られがち。
- データベースにカラムを追加したときに追加カラムに挿入するデータの計算と更新
- 意図せず起きたデータ不整合の解消
- データ分析基盤はないけど何らかのデータ分析結果を出す必要がある

本質的にやりたい処理以外でいろいろ作る必要がある
- バッチ処理をキックするCLIの実装
- バッチ処理失敗時のロギング、エラー処理
- 処理時間がかかりすぎるので並列化したい

本質的にやりたい処理以外の部分を独自実装してもいいけどテストやレビューで消耗したくない。
で、よく知られたパティーンがあればそれを使おう。

そう思ったけどパターンの実装を見ても挙動としてはスマートなんだろうけど
直観としてわかりにくい。

今回は並列化、さらに並列化のパターンの中でパイプラインパターンに絞って紹介する。

自分で並列化の実装を書くと以下のような作りになった
- 処理対象を探す
- どのワーカーがどの処理を担当するか決める
- ワーカーを実行する

この実装の問題
- どのワーカーがどの処理を担当するか決める部分は本質的ではないけど複雑になる

パイプラインパターンは
Goブログが初出？
https://blog.golang.org/pipelines

パイプラインパターンは並列化のパターンだけどパット見うまく動くのかよくわかんない。
チャネルをクローズするべき場面でクローズしてない、あるいはクローズしていけない場面でクローズしてpanicがおきる


### スライドリスト
- [] タイトル
- [] 目次
  
